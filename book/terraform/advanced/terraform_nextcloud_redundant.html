<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Nextcloud Redundant Deployment</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../intro/intro_readme.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../intro/grid3_howitworks.html"><strong aria-hidden="true">2.</strong> How it Works</a></li><li class="chapter-item expanded "><a href="../../concepts/concepts_readme.html"><strong aria-hidden="true">3.</strong> Grid Concepts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../concepts/grid_primitives.html"><strong aria-hidden="true">3.1.</strong> TFGrid Primitives</a></li><li class="chapter-item "><a href="../../concepts/grid3_components.html"><strong aria-hidden="true">3.2.</strong> TFGrid Component List</a></li><li class="chapter-item "><a href="../../concepts/grid3_iac.html"><strong aria-hidden="true">3.3.</strong> Infrastructure as Code</a></li><li class="chapter-item "><a href="../../concepts/proof_of_utilization.html"><strong aria-hidden="true">3.4.</strong> Proof of Utilization</a></li><li class="chapter-item "><a href="../../concepts/contract_grace_period.html"><strong aria-hidden="true">3.5.</strong> Contract Grace Period</a></li><li class="chapter-item "><a href="../../concepts/buying_storing_tft.html"><strong aria-hidden="true">3.6.</strong> Buying and Storing TFTs</a></li><li class="chapter-item "><a href="../../concepts/grid3_whatsnew.html"><strong aria-hidden="true">3.7.</strong> What's New on TFGrid v3.x</a></li><li class="chapter-item "><a href="../../concepts/tfchain.html"><strong aria-hidden="true">3.8.</strong> TFChain</a></li></ol></li><li class="chapter-item expanded "><a href="../../getstarted/tfgrid3_getstarted.html"><strong aria-hidden="true">4.</strong> Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../getstarted/TF_Connect/TF_Connect.html"><strong aria-hidden="true">4.1.</strong> ThreeFold Connect</a></li><li class="chapter-item "><a href="../../getstarted/TF_Token/tft_toc.html"><strong aria-hidden="true">4.2.</strong> ThreeFold Token</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../getstarted/TF_Token/tft_lobstr/tft_lobstr.html"><strong aria-hidden="true">4.2.1.</strong> TFT on Lobstr</a></li><li class="chapter-item "><a href="../../getstarted/TF_Token/tft_ethereum/tft_ethereum.html"><strong aria-hidden="true">4.2.2.</strong> TFT on Ethereum</a></li></ol></li><li class="chapter-item "><a href="../../getstarted/TF_Dashboard/TF_Dashboard.html"><strong aria-hidden="true">4.3.</strong> ThreeFold Dashboard</a></li><li class="chapter-item "><a href="../../dashboard/explorer/explorer_find_capacity.html"><strong aria-hidden="true">4.4.</strong> Tutorial: Find Node</a></li><li class="chapter-item "><a href="../../weblets/weblets_vm.html"><strong aria-hidden="true">4.5.</strong> Tutorial: Deploy Your First VM</a></li><li class="chapter-item "><a href="../../getstarted/ssh_guide/ssh_guide.html"><strong aria-hidden="true">4.6.</strong> SSH Remote Connection</a></li><li class="chapter-item "><a href="../../getstarted/remote-desktop_gui/remote-desktop_gui.html"><strong aria-hidden="true">4.7.</strong> Remote Desktop and GUI</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../getstarted/remote-desktop_gui/cockpit_guide/cockpit_guide.html"><strong aria-hidden="true">4.7.1.</strong> Cockpit: a Web-based Interface for Servers</a></li><li class="chapter-item "><a href="../../getstarted/remote-desktop_gui/xrdp_guide/xrdp_guide.html"><strong aria-hidden="true">4.7.2.</strong> XRDP: an Open-Source Remote Desktop Protocol</a></li><li class="chapter-item "><a href="../../getstarted/remote-desktop_gui/guacamole_guide/guacamole_guide.html"><strong aria-hidden="true">4.7.3.</strong> Apache Guacamole: a Clientless Remote Desktop Gateway</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../tokens/tft_readme.html"><strong aria-hidden="true">5.</strong> TFT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tokens/buytft/buytft_readme.html"><strong aria-hidden="true">5.1.</strong> Get TFT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tokens/buytft/pancakeswap.html"><strong aria-hidden="true">5.1.1.</strong> Pancake Swap</a></li><li class="chapter-item "><a href="../../tokens/buytft/oneinch.html"><strong aria-hidden="true">5.1.2.</strong> 1inch.io</a></li><li class="chapter-item "><a href="../../tokens/buytft/gettft.html"><strong aria-hidden="true">5.1.3.</strong> GetTFT.com</a></li><li class="chapter-item "><a href="../../tokens/buytft/albedo_buy.html"><strong aria-hidden="true">5.1.4.</strong> Albedo</a></li></ol></li><li class="chapter-item "><a href="../../tokens/storetft/storetft_readme.html"><strong aria-hidden="true">5.2.</strong> Store TFT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tokens/storetft/metamask.html"><strong aria-hidden="true">5.2.1.</strong> Metamask (TFT-BSC)</a></li><li class="chapter-item "><a href="../../tokens/storetft/trustwallet.html"><strong aria-hidden="true">5.2.2.</strong> Trust Wallet (TFT-BSC)</a></li><li class="chapter-item "><a href="../../tokens/storetft/albedo_store.html"><strong aria-hidden="true">5.2.3.</strong> Albedo (TFT-Stellar)</a></li></ol></li><li class="chapter-item "><a href="../../tokens/liquidity/liquidity_readme.html"><strong aria-hidden="true">5.3.</strong> Provide Liquidity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tokens/liquidity/liquidity_pancake.html"><strong aria-hidden="true">5.3.1.</strong> LP on Pancake Swap</a></li><li class="chapter-item "><a href="../../tokens/liquidity/liquidity_1inch.html"><strong aria-hidden="true">5.3.2.</strong> LP on 1inch.io</a></li><li class="chapter-item "><a href="../../tokens/liquidity/liquidity_albedo.html"><strong aria-hidden="true">5.3.3.</strong> LP on Albedo</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../getstarted/planetarynetwork.html"><strong aria-hidden="true">6.</strong> Planetary Network</a></li><li class="chapter-item expanded "><a href="../../terraform/terraform_readme.html"><strong aria-hidden="true">7.</strong> Terraform</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../terraform/terraform_install.html"><strong aria-hidden="true">7.1.</strong> Installing Terraform</a></li><li class="chapter-item "><a href="../../terraform/terraform_basics.html"><strong aria-hidden="true">7.2.</strong> Terraform Basics</a></li><li class="chapter-item "><a href="../../terraform/terraform_get_started.html"><strong aria-hidden="true">7.3.</strong> Tutorial</a></li><li class="chapter-item "><a href="../../terraform/terraform_delete.html"><strong aria-hidden="true">7.4.</strong> Delete</a></li><li class="chapter-item "><a href="../../terraform/terraform_full_vm.html"><strong aria-hidden="true">7.5.</strong> Full VM Deployment</a></li><li class="chapter-item "><a href="../../terraform/resources/terraform_resources_readme.html"><strong aria-hidden="true">7.6.</strong> Resources</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../terraform/resources/terraform_vm.html"><strong aria-hidden="true">7.6.1.</strong> Virtual Machine</a></li><li class="chapter-item "><a href="../../terraform/resources/terraform_vm_gateway.html"><strong aria-hidden="true">7.6.2.</strong> Web Gateway</a></li><li class="chapter-item "><a href="../../terraform/resources/terraform_k8s.html"><strong aria-hidden="true">7.6.3.</strong> Kubernetes Cluster</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../terraform/resources/terraform_k8s_demo.html"><strong aria-hidden="true">7.6.3.1.</strong> Demo</a></li></ol></li><li class="chapter-item "><a href="../../terraform/resources/terraform_zdb.html"><strong aria-hidden="true">7.6.4.</strong> ZDB</a></li><li class="chapter-item "><a href="../../terraform/resources/terraform_qsfs.html"><strong aria-hidden="true">7.6.5.</strong> Quantum Filesystem</a></li><li class="chapter-item "><a href="../../terraform/resources/terraform_caprover.html"><strong aria-hidden="true">7.6.6.</strong> CapRover</a></li></ol></li><li class="chapter-item expanded "><a href="../../terraform/advanced/terraform_advanced_readme.html"><strong aria-hidden="true">7.7.</strong> Advanced</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../terraform/advanced/terraform_provider.html"><strong aria-hidden="true">7.7.1.</strong> Terraform Provider</a></li><li class="chapter-item "><a href="../../terraform/advanced/terraform_provisioners.html"><strong aria-hidden="true">7.7.2.</strong> Terraform Provisioners</a></li><li class="chapter-item "><a href="../../terraform/advanced/terraform_mounts.html"><strong aria-hidden="true">7.7.3.</strong> Mounts</a></li><li class="chapter-item "><a href="../../terraform/advanced/terraform_capacity_planning.html"><strong aria-hidden="true">7.7.4.</strong> Capacity Planning</a></li><li class="chapter-item "><a href="../../terraform/advanced/terraform_updates.html"><strong aria-hidden="true">7.7.5.</strong> Updates</a></li><li class="chapter-item expanded "><a href="../../terraform/advanced/terraform_nextcloud_redundant.html" class="active"><strong aria-hidden="true">7.7.6.</strong> Nextcloud Redundant Deployment</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../javascript/grid3_javascript_readme.html"><strong aria-hidden="true">8.</strong> Javascript Client</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../javascript/grid3_javascript_installation.html"><strong aria-hidden="true">8.1.</strong> Installation</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_loadclient.html"><strong aria-hidden="true">8.2.</strong> Loading Client</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_vm.html"><strong aria-hidden="true">8.3.</strong> Deploy a VM</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_capacity_planning.html"><strong aria-hidden="true">8.4.</strong> Capacity Planning</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_vms.html"><strong aria-hidden="true">8.5.</strong> Deploy Multiple VMs</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_caprover.html"><strong aria-hidden="true">8.6.</strong> Deploy CapRover</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_vm_gateways.html"><strong aria-hidden="true">8.7.</strong> Gateways</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_kubernetes.html"><strong aria-hidden="true">8.8.</strong> Deploy a Kubernetes Cluster</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_zdb.html"><strong aria-hidden="true">8.9.</strong> Deploy a ZDB</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_qsfs_zdbs.html"><strong aria-hidden="true">8.10.</strong> Deploy ZDBs for QSFS</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_qsfs.html"><strong aria-hidden="true">8.11.</strong> QSFS</a></li><li class="chapter-item "><a href="../../javascript/grid3_javascript_kvstore.html"><strong aria-hidden="true">8.12.</strong> Key Value Store</a></li><li class="chapter-item "><a href="../../javascript/grid3_wireguard_gateway.html"><strong aria-hidden="true">8.13.</strong> Gateway with wireguard backend</a></li></ol></li><li class="chapter-item expanded "><a href="../../go/grid3_go_readme.html"><strong aria-hidden="true">9.</strong> Go Client</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../go/grid3_go_installation.html"><strong aria-hidden="true">9.1.</strong> Installation</a></li><li class="chapter-item "><a href="../../go/grid3_go_load_client.html"><strong aria-hidden="true">9.2.</strong> Loading Client</a></li><li class="chapter-item "><a href="../../go/grid3_go_vm.html"><strong aria-hidden="true">9.3.</strong> Deploy a VM</a></li><li class="chapter-item "><a href="../../go/grid3_go_vms.html"><strong aria-hidden="true">9.4.</strong> Deploy Multiple VMs</a></li><li class="chapter-item "><a href="../../go/grid3_go_gateways.html"><strong aria-hidden="true">9.5.</strong> Deploy Gateways</a></li><li class="chapter-item "><a href="../../go/grid3_go_kubernetes.html"><strong aria-hidden="true">9.6.</strong> Deploy Kubernetes</a></li></ol></li><li class="chapter-item expanded "><a href="../../tfgridcmd/grid3_cli_readme.html"><strong aria-hidden="true">10.</strong> TFGrid CLI</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tfgridcmd/grid3_cli_installation.html"><strong aria-hidden="true">10.1.</strong> Installation</a></li><li class="chapter-item "><a href="../../tfgridcmd/grid3_cli_login.html"><strong aria-hidden="true">10.2.</strong> Login</a></li><li class="chapter-item "><a href="../../tfgridcmd/grid3_cli_vm.html"><strong aria-hidden="true">10.3.</strong> Deploy a VM</a></li><li class="chapter-item "><a href="../../tfgridcmd/grid3_cli_gateways.html"><strong aria-hidden="true">10.4.</strong> Deploy Gateways</a></li><li class="chapter-item "><a href="../../tfgridcmd/grid3_cli_kubernetes.html"><strong aria-hidden="true">10.5.</strong> Deploy Kubernetes</a></li></ol></li><li class="chapter-item expanded "><a href="../../TF_Grid_Services/tf_grid_services_readme.html"><strong aria-hidden="true">11.</strong> TFGrid Services</a></li><li class="chapter-item expanded "><a href="../../cloud/cloud.html"><strong aria-hidden="true">12.</strong> Cloud</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../cloud/cloudunits_pricing.html"><strong aria-hidden="true">12.1.</strong> Pricing</a></li></ol></li><li class="chapter-item expanded "><a href="../../weblets/weblets_home.html"><strong aria-hidden="true">13.</strong> Weblets</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../weblets/weblets_profile_manager.html"><strong aria-hidden="true">13.1.</strong> Profile Manager</a></li><li class="chapter-item "><a href="../../weblets/weblets_deployments_list.html"><strong aria-hidden="true">13.2.</strong> Deployments List</a></li><li class="chapter-item "><a href="../../weblets/weblets_cancel_contracts.html"><strong aria-hidden="true">13.3.</strong> Cancel Contracts</a></li><li class="chapter-item "><a href="../../weblets/weblets_basic_environments_readme.html"><strong aria-hidden="true">13.4.</strong> Basic Environments</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../weblets/weblets_fullVm.html"><strong aria-hidden="true">13.4.1.</strong> Full Virtual Machine</a></li><li class="chapter-item "><a href="../../weblets/weblets_vm.html"><strong aria-hidden="true">13.4.2.</strong> Virtual Machine</a></li><li class="chapter-item "><a href="../../weblets/weblets_k8s.html"><strong aria-hidden="true">13.4.3.</strong> Kubernetes</a></li><li class="chapter-item "><a href="../../weblets/weblets_nixos_micro.html"><strong aria-hidden="true">13.4.4.</strong> Nixos MicroVM</a></li></ol></li><li class="chapter-item "><a href="../../weblets/weblets_ready_community_readme.html"><strong aria-hidden="true">13.5.</strong> Ready Community Solutions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../weblets/weblets_algorand.html"><strong aria-hidden="true">13.5.1.</strong> Algorand</a></li><li class="chapter-item "><a href="../../weblets/weblets_caprover.html"><strong aria-hidden="true">13.5.2.</strong> Caprover</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../weblets/weblets_caprover_admin.html"><strong aria-hidden="true">13.5.2.1.</strong> Caprover Admin</a></li><li class="chapter-item "><a href="../../weblets/weblets_caprover_worker.html"><strong aria-hidden="true">13.5.2.2.</strong> Caprover Worker</a></li></ol></li><li class="chapter-item "><a href="../../weblets/weblets_casper.html"><strong aria-hidden="true">13.5.3.</strong> CasperLabs</a></li><li class="chapter-item "><a href="../../weblets/weblets_discourse.html"><strong aria-hidden="true">13.5.4.</strong> Discourse</a></li><li class="chapter-item "><a href="../../weblets/weblets_funkwhale.html"><strong aria-hidden="true">13.5.5.</strong> Funkwhale</a></li><li class="chapter-item "><a href="../../weblets/weblets_mastodon.html"><strong aria-hidden="true">13.5.6.</strong> Mastodon Weblet</a></li><li class="chapter-item "><a href="../../weblets/weblets_mattermost.html"><strong aria-hidden="true">13.5.7.</strong> Mattermost</a></li><li class="chapter-item "><a href="../../weblets/weblets_nodepilot.html"><strong aria-hidden="true">13.5.8.</strong> Node Pilot</a></li><li class="chapter-item "><a href="../../weblets/weblets_owncloud.html"><strong aria-hidden="true">13.5.9.</strong> Owncloud</a></li><li class="chapter-item "><a href="../../weblets/weblets_peertube.html"><strong aria-hidden="true">13.5.10.</strong> Peertube</a></li><li class="chapter-item "><a href="../../weblets/weblets_presearch.html"><strong aria-hidden="true">13.5.11.</strong> Presearch</a></li><li class="chapter-item "><a href="../../weblets/weblets_subsquid.html"><strong aria-hidden="true">13.5.12.</strong> Subsquid</a></li><li class="chapter-item "><a href="../../weblets/weblets_taiga.html"><strong aria-hidden="true">13.5.13.</strong> Taiga</a></li><li class="chapter-item "><a href="../../weblets/weblets_umbrel.html"><strong aria-hidden="true">13.5.14.</strong> Umbrel</a></li><li class="chapter-item "><a href="../../weblets/weblets_wordpress.html"><strong aria-hidden="true">13.5.15.</strong> WordPress</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../dashboard/dashboard.html"><strong aria-hidden="true">14.</strong> Dashboard</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../dashboard/explorer/explorer_home.html"><strong aria-hidden="true">14.1.</strong> Dasboard Explorer</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../dashboard/explorer/explorer_find_capacity.html"><strong aria-hidden="true">14.1.1.</strong> Find Capacity</a></li><li class="chapter-item "><a href="../../dashboard/explorer/explorer_graphql_intro.html"><strong aria-hidden="true">14.1.2.</strong> A Glimpse into GraphQL</a></li></ol></li><li class="chapter-item "><a href="../../dashboard/portal/dashboard_portal_home.html"><strong aria-hidden="true">14.2.</strong> TFChain Portal</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../dashboard/portal/dashboard_portal_ui_tokens.html"><strong aria-hidden="true">14.2.1.</strong> Manage TFTs on TFChain</a></li><li class="chapter-item "><a href="../../dashboard/portal/dashboard_portal_ui_farming.html"><strong aria-hidden="true">14.2.2.</strong> Activate Farmer Account and Nodes on TFChain</a></li><li class="chapter-item "><a href="../../dashboard/portal/dashboard_portal_dedicated_nodes.html"><strong aria-hidden="true">14.2.3.</strong> Dedicated Nodes</a></li></ol></li><li class="chapter-item "><a href="../../dashboard/dao_voting/dao_voting.html"><strong aria-hidden="true">14.3.</strong> DAO Voting</a></li></ol></li><li class="chapter-item expanded "><a href="../../flist_hub/flist_hub.html"><strong aria-hidden="true">15.</strong> Flist Hub</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../manual3_iac/grid3_supported_flists.html"><strong aria-hidden="true">15.1.</strong> Supported FLists</a></li></ol></li><li class="chapter-item expanded "><a href="../../farmers/farmers.html"><strong aria-hidden="true">16.</strong> Farmers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../farmers/3node_building/3node_building.html"><strong aria-hidden="true">16.1.</strong> Build a 3Node</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../farmers/3node_building/1_create_farm.html"><strong aria-hidden="true">16.1.1.</strong> 1. Create a Farm</a></li><li class="chapter-item "><a href="../../farmers/3node_building/2_bootstrap_image.html"><strong aria-hidden="true">16.1.2.</strong> 2. Create a Zero-OS Bootstrap Image</a></li><li class="chapter-item "><a href="../../farmers/3node_building/3_set_hardware.html"><strong aria-hidden="true">16.1.3.</strong> 3. Set the Hardware</a></li><li class="chapter-item "><a href="../../farmers/3node_building/4_wipe_all_disks.html"><strong aria-hidden="true">16.1.4.</strong> 4. Wipe All the Disks</a></li><li class="chapter-item "><a href="../../farmers/3node_building/5_set_bios_uefi.html"><strong aria-hidden="true">16.1.5.</strong> 5. Set the BIOS/UEFI</a></li><li class="chapter-item "><a href="../../farmers/3node_building/6_boot_3node.html"><strong aria-hidden="true">16.1.6.</strong> 6. Boot the 3Node</a></li><li class="chapter-item "><a href="../../farmers/3node_building/data_center.html"><strong aria-hidden="true">16.1.7.</strong> Set Up a ThreeFold Farm in a Data Center</a></li></ol></li><li class="chapter-item "><a href="../../farmers/complete_diy_guides/complete_diy_guides_readme.html"><strong aria-hidden="true">16.2.</strong> Complete DIY 3Node Guides</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../farmers/complete_diy_guides/3node_diy_desktop/3node_diy_desktop.html"><strong aria-hidden="true">16.2.1.</strong> 3Node Desktop DIY Guide</a></li><li class="chapter-item "><a href="../../farmers/complete_diy_guides/3node_diy_rack_server/3node_diy_rack_server.html"><strong aria-hidden="true">16.2.2.</strong> 3Node Rack Server DIY Guide</a></li></ol></li><li class="chapter-item "><a href="../../farmers/farming_optimization/farming_optimization.html"><strong aria-hidden="true">16.3.</strong> Farming Optimization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../farmers/farming_optimization/calculate_roi.html"><strong aria-hidden="true">16.3.1.</strong> Calculate Your ROI</a></li><li class="chapter-item "><a href="../../farmers/farming_optimization/farm_room_parameters.html"><strong aria-hidden="true">16.3.2.</strong> Room Parameters</a></li><li class="chapter-item "><a href="../../farmers/farming_optimization/farming_costs.html"><strong aria-hidden="true">16.3.3.</strong> Farming Costs</a></li></ol></li><li class="chapter-item "><a href="../../farmers/threefold_token/threefold_token.html"><strong aria-hidden="true">16.4.</strong> TFT and Farming</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../farmers/threefold_token/tft_facts.html"><strong aria-hidden="true">16.4.1.</strong> TFT Facts</a></li><li class="chapter-item "><a href="../../farmers/threefold_token/storing_tft/storing_tft.html"><strong aria-hidden="true">16.4.2.</strong> Storing TFT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../farmers/threefold_token/storing_tft/tf_connect_app.html"><strong aria-hidden="true">16.4.2.1.</strong> TF Connect App</a></li><li class="chapter-item "><a href="../../farmers/threefold_token/storing_tft/hardware_wallet.html"><strong aria-hidden="true">16.4.2.2.</strong> Hardware Wallet</a></li></ol></li><li class="chapter-item "><a href="../../farmers/threefold_token/buy_sell_tft/buy_sell_tft.html"><strong aria-hidden="true">16.4.3.</strong> Buy and Sell TFT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../farmers/threefold_token/buy_sell_tft/set_stellar_address.html"><strong aria-hidden="true">16.4.3.1.</strong> Set a Stellar Address</a></li><li class="chapter-item "><a href="../../getstarted/TF_Token/tft_lobstr/tft_lobstr.html"><strong aria-hidden="true">16.4.3.2.</strong> TFT on Lobstr</a></li><li class="chapter-item "><a href="../../farmers/threefold_token/buy_sell_tft/tft_bridges.html"><strong aria-hidden="true">16.4.3.3.</strong> TFT Bridges</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../farmers/threefold_token/buy_sell_tft/bsc_stellar_bridge.html"><strong aria-hidden="true">16.4.3.3.1.</strong> BSC-Stellar Bridge</a></li><li class="chapter-item "><a href="../../farmers/threefold_token/buy_sell_tft/tfchain_stellar_bridge.html"><strong aria-hidden="true">16.4.3.3.2.</strong> TFChain-Stellar Bridge</a></li><li class="chapter-item "><a href="../../getstarted/TF_Token/tft_ethereum/tft_ethereum.html"><strong aria-hidden="true">16.4.3.3.3.</strong> Ethereum-Stellar Bridge</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../../farmers/farmerbot/farmerbot.html"><strong aria-hidden="true">16.5.</strong> Farmerbot</a></li><li class="chapter-item "><a href="../../farmers/farmers_faq/farmers_faq.html"><strong aria-hidden="true">16.6.</strong> Farmers FAQ</a></li></ol></li><li class="chapter-item expanded "><a href="../../tf_video_gallery/tf_video_gallery.html"><strong aria-hidden="true">17.</strong> ThreeFold Video Gallery</a></li><li class="chapter-item expanded "><a href="../../tf_mastodon/tf_mastodon_readme.html"><strong aria-hidden="true">18.</strong> ThreeFold Mastodon Server</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tf_mastodon/tf_mastodon_deploy.html"><strong aria-hidden="true">18.1.</strong> Mastodon Deployer Manual</a></li><li class="chapter-item "><a href="../../tf_mastodon/tf_mastodon_faq.html"><strong aria-hidden="true">18.2.</strong> Frequently Asked Questions</a></li></ol></li><li class="chapter-item expanded "><a href="../../proxy/proxy.html"><strong aria-hidden="true">19.</strong> Grid Proxy</a></li><li class="chapter-item expanded "><a href="../../advanced/advanced.html"><strong aria-hidden="true">20.</strong> Advanced</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../advanced/grid3_stellar_tfchain_bridge.html"><strong aria-hidden="true">20.1.</strong> Grid3 Stellar-TFChain Bridge</a></li><li class="chapter-item "><a href="../../advanced/token_transfer_keygenerator.html"><strong aria-hidden="true">20.2.</strong> Token Transfer Keygenerator</a></li><li class="chapter-item "><a href="../../advanced/cancel_contracts.html"><strong aria-hidden="true">20.3.</strong> Cancel contracts</a></li><li class="chapter-item "><a href="../../advanced/contract_bill_report.html"><strong aria-hidden="true">20.4.</strong> Contract Bills Reports</a></li><li class="chapter-item "><a href="../../advanced/list_public_ips.html"><strong aria-hidden="true">20.5.</strong> Listing Free Public IPs</a></li><li class="chapter-item "><a href="../../advanced/grid3_redis.html"><strong aria-hidden="true">20.6.</strong> Redis</a></li></ol></li><li class="chapter-item expanded "><a href="../../roadmap/roadmap_readme.html"><strong aria-hidden="true">21.</strong> ThreeFold Roadmap</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../roadmap/releasenotes/releasenotes_readme.html"><strong aria-hidden="true">21.1.</strong> Release Notes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_9_0.html"><strong aria-hidden="true">21.1.1.</strong> TFGrid v3.9.0</a></li><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_8_0.html"><strong aria-hidden="true">21.1.2.</strong> TFGrid v3.8.0</a></li><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_7_0.html"><strong aria-hidden="true">21.1.3.</strong> TFGrid v3.7.0</a></li><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_6_1.html"><strong aria-hidden="true">21.1.4.</strong> TFGrid v3.6.1</a></li><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_6_0.html"><strong aria-hidden="true">21.1.5.</strong> TFGrid v3.6.0</a></li><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_0_a5.html"><strong aria-hidden="true">21.1.6.</strong> TFGrid v3.0.0 Alpha-5</a></li><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_0_a4.html"><strong aria-hidden="true">21.1.7.</strong> TFGrid v3.0.0 Alpha-4</a></li><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_0_a2.html"><strong aria-hidden="true">21.1.8.</strong> TFGrid v3.0.0 Alpha-2</a></li><li class="chapter-item "><a href="../../roadmap/releasenotes/tfgrid_release_3_0.html"><strong aria-hidden="true">21.1.9.</strong> TFGrid v3.0.0</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../tfchain/tfchain.html"><strong aria-hidden="true">22.</strong> ThreeFold Chain</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tfchain/introduction.html"><strong aria-hidden="true">22.1.</strong> Introduction</a></li><li class="chapter-item "><a href="../../tfchain/farming_policies.html"><strong aria-hidden="true">22.2.</strong> Farming Policies</a></li><li class="chapter-item "><a href="../../tfchain/tfchain_external_service_contract.html"><strong aria-hidden="true">22.3.</strong> External Service Contract</a></li><li class="chapter-item "><a href="../../tfchain/tfchain_solution_provider.html"><strong aria-hidden="true">22.4.</strong> Become a Solution Provider</a></li></ol></li><li class="chapter-item expanded "><a href="../../collaboration_tools/collaboration_tools.html"><strong aria-hidden="true">23.</strong> Collaboration Tools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../collaboration_tools/circle_tool.html"><strong aria-hidden="true">23.1.</strong> Circle Tool</a></li><li class="chapter-item "><a href="../../collaboration_tools/website_tool.html"><strong aria-hidden="true">23.2.</strong> Website Deployer</a></li></ol></li><li class="chapter-item expanded "><a href="../../contribute/contribute.html"><strong aria-hidden="true">24.</strong> How to Contribute</a></li><li class="chapter-item expanded "><a href="../../testing/testing_readme.html"><strong aria-hidden="true">25.</strong> How to Test</a></li><li class="chapter-item expanded "><a href="../../faq/faq.html"><strong aria-hidden="true">26.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="../../legal/legal.html"><strong aria-hidden="true">27.</strong> Legal</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="nextcloud-redundant-deployment-on-two-3node-servers"><a class="header" href="#nextcloud-redundant-deployment-on-two-3node-servers">Nextcloud Redundant Deployment on Two 3node Servers</a></h1>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#main-steps">Main Steps</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#find-two-3nodes-with-the-necessary-resources">Find Two 3nodes with the Necessary Resources</a></li>
<li><a href="#set-the-vms">Set the VMs</a>
<ul>
<li><a href="#create-a-two-servers-wireguard-vpn-with-terraform">Create a Two Servers Wireguard VPN with Terraform</a>
<ul>
<li><a href="#create-the-terraform-files">Create the Terraform Files</a></li>
<li><a href="#deploy-the-3nodes-with-terraform">Deploy the 3nodes with Terraform</a></li>
<li><a href="#ssh-into-the-3nodes">SSH into the 3nodes</a></li>
<li><a href="#preparing-the-vms-for-the-deployment">Preparing the VMs for the Deployment</a></li>
<li><a href="#test-the-wireguard-connection">Test the Wireguard Connection</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#create-the-mariadb-database">Create the MariaDB Database</a>
<ul>
<li><a href="#download-mariadb-and-configure-the-database">Download MariaDB and Configure the Database</a></li>
<li><a href="#create-user-with-replication-grant">Create User with Replication Grant</a></li>
<li><a href="#verify-the-access-of-the-user">Verify the Access of the User</a></li>
<li><a href="#set-the-vms-to-accept-the-mariadb-connection">Set the VMs to Accept the MariaDB Connection</a>
<ul>
<li><a href="#tf-template-worker-server-data">TF Template Worker Server Data</a></li>
<li><a href="#tf-template-master-server-data">TF Template Master Server Data</a></li>
</ul>
</li>
<li><a href="#set-the-nextcloud-user-and-database">Set the Nextcloud User and Database</a></li>
</ul>
</li>
<li><a href="#install-and-set-glusterfs">Install and Set GlusterFS</a></li>
<li><a href="#install-php-and-nextcloud">Install PHP and Nextcloud</a></li>
<li><a href="#create-a-subdomain-with-duckdns">Create a Subdomain with DuckDNS</a>
<ul>
<li><a href="#worker-file-for-duckdns">Worker File for DuckDNS</a></li>
</ul>
</li>
<li><a href="#set-apache">Set Apache</a></li>
<li><a href="#access-nextcloud-on-a-web-browser-with-the-subdomain">Access Nextcloud on a Web Browser with the Subdomain</a></li>
<li><a href="#enable-https">Enable HTTPS</a>
<ul>
<li><a href="#install-certbot">Install Certbot</a></li>
<li><a href="#set-the-certbot-with-the-dns-domain">Set the Certbot with the DNS Domain</a></li>
<li><a href="#verify-https-automatic-renewal">Verify HTTPS Automatic Renewal</a></li>
</ul>
</li>
<li><a href="#set-a-firewall">Set a Firewall</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#acknowledgements-and-references">Acknowledgements and References</a></li>
</ul>
<hr />
<h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>In this Threefold Guide, we deploy a redundant <a href="https://nextcloud.com/">Nextcloud</a> instance that is continually synced on two different 3node servers running on the <a href="https://threefold.io/">Threefold Grid</a>.</p>
<p>We will learn how to deploy two micro virtual machines (Ubuntu 22.04) with <a href="https://www.terraform.io/">Terraform</a>. The Terraform deployment will be composed of a virtual private network (VPN) using <a href="https://www.wireguard.com/">Wireguard</a>. The two VMs will thus be connected in a private and secure network. Once this is done, we will link the two VMs together by setting up a <a href="https://mariadb.org/">MariaDB</a> database and using <a href="https://www.gluster.org/">GlusterFS</a>. Then, we will install and deploy Nextcloud. We will add a DDNS (dynamic DNS) domain to the Nextcloud deployment. It will then be possible to connect to the Nextcloud instance over public internet. Nextcloud will be available over your computer and even your smart phone! We will also set HTTPS for the DDNS domain in order to make the Nextcloud instance as secure as possible. You are free to explore different DDNS options. In this guide, we will be using <a href="https://www.duckdns.org/">DuckDNS</a> for simplicity.</p>
<p>The advantage of this redundant Nextcloud deployment is obvious: if one of the two VMs goes down, the Nextcloud instance will still be accessible, as the other VM will take the lead. Also, the two VMs will be continually synced in real-time. If the master node goes down, the data will be synced to the worker node, and the worker node will become the master node. Once the master VM goes back online, the data will be synced to the master node and the master node will retake the lead as the master node.</p>
<p>This kind of real-time backup of the database is not only limited to Nextcloud. You can use the same architecture to deploy different workloads while having the redundancy over two 3node servers. This architecture could be deployed over more than two 3nodes. Feel free to explore and let us know in the <a href="http://forum.threefold.io/">Threefold Forum</a> if you come up with exciting and different variations of this kind of deployment.</p>
<p>As always, if you have questions concerning this guide, you can write a post on the <a href="http://forum.threefold.io/">Threefold Forum</a>.</p>
<p>Let's go!</p>
<hr />
<h1 id="main-steps"><a class="header" href="#main-steps">Main Steps</a></h1>
<p>This guide might seem overwhelming, but the steps are carefully explained. Take your time and it will all work out!</p>
<p>To get an overview of the whole process, we present the main steps:</p>
<ul>
<li>Download the dependencies</li>
<li>Find two 3nodes on the TF Grid</li>
<li>Deploy and set the VMs with Terraform</li>
<li>Create a MariaDB database</li>
<li>Download and set GlusterFS</li>
<li>Install PHP and Nextcloud</li>
<li>Create a subdomain with DuckDNS</li>
<li>Set Apache</li>
<li>Access Nextcloud</li>
<li>Add HTTPS protection</li>
<li>Set a firewall</li>
</ul>
<hr />
<h1 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h1>
<ul>
<li><a href="https://developer.hashicorp.com/terraform/downloads">Install Terraform</a></li>
<li><a href="https://www.wireguard.com/install/">Install Wireguard</a></li>
</ul>
<p>You need to download and install properly Terraform and Wireguard on your local computer. Simply follow the documentation depending on your operating system (Linux, MAC and Windows).</p>
<hr />
<h1 id="find-two-3nodes-with-the-necessary-resources"><a class="header" href="#find-two-3nodes-with-the-necessary-resources">Find Two 3nodes with the Necessary Resources</a></h1>
<p>We first need to decide on which 3nodes we will be deploying our workload.</p>
<p>We thus start by finding two 3nodes with IPv4 addresses and see if they have enough resources. For our Nextcloud deployment, we want at least 1 CPU and 2 GB of memory. For the storage, we use 50 GB.</p>
<ul>
<li>Go to the Threefold Grid's <a href="https://graphql.grid.tf/graphql">GraphQL</a>.</li>
<li>Write the following query</li>
</ul>
<pre><code>query MyQuery {
  publicConfigs {
    node {
      nodeID
      resourcesTotal {
        cru
        mru
        sru
      }
    }
    ipv4
  }
}
</code></pre>
<ul>
<li>Press the &quot;Play&quot; button</li>
<li>Find two 3nodes that suit the deployment's needs (under <code>nodeID</code>)</li>
</ul>
<hr />
<h1 id="set-the-vms"><a class="header" href="#set-the-vms">Set the VMs</a></h1>
<h2 id="create-a-two-servers-wireguard-vpn-with-terraform"><a class="header" href="#create-a-two-servers-wireguard-vpn-with-terraform">Create a Two Servers Wireguard VPN with Terraform</a></h2>
<p>For this guide, we use two files to deploy with Terraform. The first file contains the environment variables and the second file contains the parameters to deploy our workloads.</p>
<p>To facilitate the deployment, only the environment variables file needs to be adjusted. The <code>main.tf</code> file contains the environment variables (e.g. <code>var.size</code> for the disk size) and thus you do not need to change this file. Of course, you can adjust the deployment based on your preferences. That being said, it should be easy to deploy the Terraform deployment with the <code>main.tf</code> as is.</p>
<p>On your local computer, create a new folder named <code>terraform</code> and a subfolder called <code>deployments</code>. In the subfolder, store the files <code>main.tf</code> and <code>credentials.auto.tfvars</code>.</p>
<p>Modify the variable files to take into account your own seed phrase and SSH keys. You should also specifiy the node IDs of the two 3nodes you will be deploying on.</p>
<h3 id="create-the-terraform-files"><a class="header" href="#create-the-terraform-files">Create the Terraform Files</a></h3>
<p>Open the terminal.</p>
<ul>
<li>
<p>Go to the home folder</p>
<ul>
<li>
<pre><code>cd ~
</code></pre>
</li>
</ul>
</li>
<li>
<p>Create the folder <code>terraform</code> and the subfolder <code>deployments</code>:</p>
<ul>
<li>
<pre><code>mkdir terraform &amp;&amp; cd $_
</code></pre>
</li>
<li>
<pre><code>mkdir deployments &amp;&amp; cd $_
</code></pre>
</li>
</ul>
</li>
<li>
<p>Create the <code>main.tf</code> file:</p>
<ul>
<li>
<pre><code>nano main.tf
</code></pre>
</li>
</ul>
</li>
<li>
<p>Copy the <code>main.tf</code> content and save the file.</p>
</li>
</ul>
<pre><code>terraform {
  required_providers {
    grid = {
      source  = &quot;threefoldtech/grid&quot;
    }
  }
}

variable &quot;mnemonics&quot; {
  type = string
}

variable &quot;SSH_KEY&quot; {
  type = string
}

variable &quot;tfnodeid1&quot; {
  type = string
}

variable &quot;tfnodeid2&quot; {
  type = string
}

variable &quot;size&quot; {
  type = string
}

variable &quot;cpu&quot; {
  type = string
}

variable &quot;memory&quot; {
  type = string
}

provider &quot;grid&quot; {
  mnemonics = var.mnemonics
  network = &quot;main&quot;
}

locals {
  name = &quot;tfvm&quot;
}

resource &quot;grid_network&quot; &quot;net1&quot; {
  name        = local.name
  nodes       = [var.tfnodeid1, var.tfnodeid2]
  ip_range    = &quot;10.1.0.0/16&quot;
  description = &quot;newer network&quot;
  add_wg_access = true
}

resource &quot;grid_deployment&quot; &quot;d1&quot; {
  disks {
    name = &quot;disk1&quot;
    size = var.size
  }
  name         = local.name
  node         = var.tfnodeid1
  network_name = grid_network.net1.name
  vms {
    name  = &quot;vm1&quot;
    flist = &quot;https://hub.grid.tf/tf-official-vms/ubuntu-22.04.flist&quot;
    cpu   = var.cpu
    mounts {
        disk_name = &quot;disk1&quot;
        mount_point = &quot;/disk1&quot;
    }
    memory     = var.memory
    entrypoint = &quot;/sbin/zinit init&quot;
    env_vars = {
      SSH_KEY = var.SSH_KEY
    }
    publicip   = true
    planetary = true
  }
}

resource &quot;grid_deployment&quot; &quot;d2&quot; {
  disks {
    name = &quot;disk2&quot;
    size = var.size
  }
  name         = local.name
  node         = var.tfnodeid2
  network_name = grid_network.net1.name

  vms {
    name       = &quot;vm2&quot;
    flist      = &quot;https://hub.grid.tf/tf-official-vms/ubuntu-22.04.flist&quot;
    cpu        = var.cpu
    mounts {
        disk_name = &quot;disk2&quot;
        mount_point = &quot;/disk2&quot;
    }
    memory     = var.memory
    entrypoint = &quot;/sbin/zinit init&quot;
    env_vars = {
      SSH_KEY = var.SSH_KEY
    }
    publicip   = true
    planetary = true
  }
}

output &quot;wg_config&quot; {
  value = grid_network.net1.access_wg_config
}
output &quot;node1_zmachine1_ip&quot; {
  value = grid_deployment.d1.vms[0].ip
}
output &quot;node1_zmachine2_ip&quot; {
  value = grid_deployment.d2.vms[0].ip
}

output &quot;ygg_ip1&quot; {
  value = grid_deployment.d1.vms[0].ygg_ip
}
output &quot;ygg_ip2&quot; {
  value = grid_deployment.d2.vms[0].ygg_ip
}

output &quot;ipv4_vm1&quot; {
  value = grid_deployment.d1.vms[0].computedip
}

output &quot;ipv4_vm2&quot; {
  value = grid_deployment.d2.vms[0].computedip
}

</code></pre>
<p>In this file, we name the first VM as <code>vm1</code> and the second VM as <code>vm2</code>. In the guide, we call <code>vm1</code> as the master VM and <code>vm2</code> as the worker VM.</p>
<p>In this guide, the virtual IP for <code>vm1</code> is 10.1.3.2 and the virtual IP for <code>vm2</code> is 10.1.4.2. This might be different during your own deployment. Change the codes in this guide accordingly.</p>
<ul>
<li>
<p>Create the <code>credentials.auto.tfvars</code> file:</p>
<ul>
<li>
<pre><code>nano credentials.auto.tfvars
</code></pre>
</li>
</ul>
</li>
<li>
<p>Copy the <code>credentials.auto.tfvars</code> content and save the file. </p>
<ul>
<li>
<pre><code>mnemonics = &quot;...&quot;
SSH_KEY = &quot;...&quot;

tfnodeid1 = &quot;...&quot;
tfnodeid2 = &quot;...&quot;

size = &quot;50&quot;
cpu = &quot;1&quot;
memory = &quot;2048&quot;
</code></pre>
</li>
</ul>
</li>
</ul>
<p>Make sure to add your own seed phrase and SSH public key. You will also need to specify the two node IDs of the servers used. Simply replace the three dots by the content. Obviously, you can decide to set more storage (size). The memory and CPU should be sufficient for the Nextcloud deployment with the above numbers.</p>
<h3 id="deploy-the-3nodes-with-terraform"><a class="header" href="#deploy-the-3nodes-with-terraform">Deploy the 3nodes with Terraform</a></h3>
<p>We now deploy the VPN with Terraform. Make sure that you are in the correct folder <code>terraform/deployments</code> with the main and variables files.</p>
<ul>
<li>
<p>Initialize Terraform:</p>
<ul>
<li>
<pre><code>terraform init
</code></pre>
</li>
</ul>
</li>
<li>
<p>Apply Terraform to deploy the VPN:</p>
<ul>
<li>
<pre><code>terraform apply
</code></pre>
</li>
</ul>
</li>
</ul>
<p>After deployments, take note of the 3nodes' IPv4 address. You will need those addresses to SSH into the 3nodes.</p>
<h3 id="ssh-into-the-3nodes"><a class="header" href="#ssh-into-the-3nodes">SSH into the 3nodes</a></h3>
<ul>
<li>
<p>To <a href="../../getstarted/ssh_guide/ssh_guide.html">SSH into the 3nodes</a>, write the following:</p>
<ul>
<li>
<pre><code>ssh root@VM_IPv4_Address
</code></pre>
</li>
</ul>
</li>
<li>
<p>If you've already deployed on other 3nodes, you might need to remove the file <code>known_hosts</code> and add the private key in the SSH <code>.ssh</code> folder:</p>
<ul>
<li>
<pre><code>rm ~/.ssh/known_hosts
</code></pre>
</li>
<li>
<pre><code>sudo ssh-add ~/.ssh/id_rsa
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="preparing-the-vms-for-the-deployment"><a class="header" href="#preparing-the-vms-for-the-deployment">Preparing the VMs for the Deployment</a></h3>
<ul>
<li>Update and upgrade the system
<ul>
<li>
<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt-get install apache2 -y
</code></pre>
</li>
</ul>
</li>
<li>After download, reboot the system
<ul>
<li>
<pre><code>sudo reboot
</code></pre>
</li>
</ul>
</li>
<li>Reconnect to the VMs</li>
</ul>
<hr />
<h3 id="test-the-wireguard-connection"><a class="header" href="#test-the-wireguard-connection">Test the Wireguard Connection</a></h3>
<p>We now want to ping the VMs using Wireguard. This will ensure the connection is properly established.</p>
<p>First, we set Wireguard with the Terraform output.</p>
<ul>
<li>
<p>On your local computer, take the Terraform's <code>wg_config</code> output and create a <code>wg.conf</code> file in the directory <code>/usr/local/etc/wireguard/wg.conf</code>.</p>
<ul>
<li>
<pre><code>nano /usr/local/etc/wireguard/wg.conf
</code></pre>
</li>
</ul>
</li>
<li>
<p>Paste the content provided by the Terraform deployment. You can use <code>terraform show</code> to see the Terraform output. The Wireguard output stands in between <code>EOT</code>.</p>
</li>
<li>
<p>Start Wireguard on your local computer:</p>
<ul>
<li>
<pre><code>wg-quick up wg
</code></pre>
</li>
</ul>
</li>
<li>
<p>To stop the wireguard service:</p>
<ul>
<li>
<pre><code>wg-quick down wg
</code></pre>
</li>
</ul>
</li>
</ul>
<p>If it doesn't work and you already did a wireguard connection with the same file from Terraform (from a previous deployment perhaps), do <code>wg-quick down wg</code>, then <code>wg-quick up wg</code>.
This should set everything properly.</p>
<ul>
<li>As a test, you can ping the virtual IP addresses of both VMs to make sure the Wireguard connection is correct:
<ul>
<li>
<pre><code>ping -c 2 10.1.3.2
</code></pre>
</li>
<li>
<pre><code>ping -c 2 10.1.4.2
</code></pre>
</li>
</ul>
</li>
</ul>
<p>If you correctly receive the packets from the two VMs, you know that the VPN is properly set.</p>
<hr />
<h1 id="create-the-mariadb-database"><a class="header" href="#create-the-mariadb-database">Create the MariaDB Database</a></h1>
<h2 id="download-mariadb-and-configure-the-database"><a class="header" href="#download-mariadb-and-configure-the-database">Download MariaDB and Configure the Database</a></h2>
<ul>
<li>
<p>Download MariaDB's server and client</p>
<ul>
<li>
<pre><code>sudo apt install mariadb-server mariadb-client -y
</code></pre>
</li>
</ul>
</li>
<li>
<p>Configure the MariaDB database</p>
<ul>
<li>
<pre><code>sudo nano /etc/mysql/mariadb.conf.d/50-server.cnf
</code></pre>
<ul>
<li>Do the following changes 
<ul>
<li>Add <code>#</code> in front of
<ul>
<li><code>bind-address = 127.0.0.1</code></li>
</ul>
</li>
<li>Remove <code>#</code> in front of the following lines and replace  <code>X</code> by <code>1</code> for the master VM and by <code>2</code> for the worker VM
<pre><code>#server-id              = X
#log_bin                = /var/log/mysql/mysql-bin.log
</code></pre>
</li>
<li>Below the lines shown above add the following line:
<pre><code>binlog_do_db           = nextcloud
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Restart MariaDB</p>
<ul>
<li>
<pre><code>sudo systemctl restart mysql
</code></pre>
</li>
</ul>
</li>
<li>
<p>Launch MariaDB</p>
<ul>
<li>
<pre><code>sudo mysql
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="create-user-with-replication-grant"><a class="header" href="#create-user-with-replication-grant">Create User with Replication Grant</a></h2>
<ul>
<li>Do the following on both VMs
<ul>
<li>
<pre><code>CREATE USER 'repuser'@'%' IDENTIFIED BY 'password';
GRANT REPLICATION SLAVE ON *.* TO 'repuser'@'%' ;
FLUSH PRIVILEGES;
show master status\G;
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="verify-the-access-of-the-user"><a class="header" href="#verify-the-access-of-the-user">Verify the Access of the User</a></h2>
<ul>
<li>Verify the access of the user
<pre><code>SELECT host FROM mysql.user WHERE User = 'repuser';
</code></pre>
<ul>
<li>You want to see <code>%</code> in Host</li>
</ul>
</li>
</ul>
<h2 id="set-the-vms-to-accept-the-mariadb-connection"><a class="header" href="#set-the-vms-to-accept-the-mariadb-connection">Set the VMs to Accept the MariaDB Connection</a></h2>
<h3 id="tf-template-worker-server-data"><a class="header" href="#tf-template-worker-server-data">TF Template Worker Server Data</a></h3>
<ul>
<li>Write the following in the worker VM
<ul>
<li>
<pre><code>CHANGE MASTER TO MASTER_HOST='10.1.3.2',
MASTER_USER='repuser',
MASTER_PASSWORD='password',
MASTER_LOG_FILE='mysql-bin.000001',
MASTER_LOG_POS=328;
</code></pre>
</li>
<li>
<pre><code>start slave;
</code></pre>
</li>
<li>
<pre><code>show slave status\G;
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="tf-template-master-server-data"><a class="header" href="#tf-template-master-server-data">TF Template Master Server Data</a></h3>
<ul>
<li>Write the following in the master VM
<ul>
<li>
<pre><code>CHANGE MASTER TO MASTER_HOST='10.1.4.2',
MASTER_USER='repuser',
MASTER_PASSWORD='password',
MASTER_LOG_FILE='mysql-bin.000001',
MASTER_LOG_POS=328;
</code></pre>
</li>
<li>
<pre><code>start slave;
</code></pre>
</li>
<li>
<pre><code>show slave status\G;
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="set-the-nextcloud-user-and-database"><a class="header" href="#set-the-nextcloud-user-and-database">Set the Nextcloud User and Database</a></h2>
<p>We now set the Nextcloud database. You should choose your own username and password. The password should be the same for the master and worker VMs.</p>
<ul>
<li>
<p>On the master VM, write:</p>
<pre><code>CREATE DATABASE nextcloud;
CREATE USER 'ncuser'@'%';
GRANT ALL PRIVILEGES ON nextcloud.* TO ncuser@'%' IDENTIFIED BY 'password1234';
FLUSH PRIVILEGES;
</code></pre>
</li>
<li>
<p>On the worker VM, write:</p>
<pre><code>CREATE USER 'ncuser'@'%';
GRANT ALL PRIVILEGES ON nextcloud.* TO ncuser@'%' IDENTIFIED BY 'password1234';
FLUSH PRIVILEGES;
</code></pre>
</li>
<li>
<p>To see the databases, write:</p>
<pre><code>show databases;
</code></pre>
</li>
<li>
<p>To see users, write:</p>
<pre><code>select user from mysql.user;
</code></pre>
</li>
<li>
<p>To exit MariaDB, write:</p>
<pre><code>exit;
</code></pre>
</li>
</ul>
<hr />
<h1 id="install-and-set-glusterfs"><a class="header" href="#install-and-set-glusterfs">Install and Set GlusterFS</a></h1>
<p>We will now install and set <a href="https://www.gluster.org/">GlusterFS</a>, a free and open source software scalable network filesystem.</p>
<ul>
<li>
<p>Install GlusterFS on both the master and worker VMs</p>
<ul>
<li>
<pre><code>echo | sudo add-apt-repository ppa:gluster/glusterfs-7 &amp;&amp; sudo apt install glusterfs-server -y
</code></pre>
</li>
</ul>
</li>
<li>
<p>Start the GlusterFS service on both VMs</p>
<ul>
<li>
<pre><code>sudo systemctl start glusterd.service &amp;&amp; sudo systemctl enable glusterd.service
</code></pre>
</li>
</ul>
</li>
<li>
<p>Set the master to worker probe IP on the master VM:</p>
<ul>
<li>
<pre><code>sudo gluster peer probe 10.1.4.2
</code></pre>
</li>
</ul>
</li>
<li>
<p>See the peer status on the worker VM:</p>
<ul>
<li>
<pre><code>sudo gluster peer status
</code></pre>
</li>
</ul>
</li>
<li>
<p>Set the master and worker IP address on the master VM:</p>
<ul>
<li>
<pre><code>sudo gluster volume create vol1 replica 2 10.1.3.2:/gluster-storage 10.1.4.2:/gluster-storage force
</code></pre>
</li>
</ul>
</li>
<li>
<p>Start GlusterFS on the master VM:</p>
<ul>
<li>
<pre><code>sudo gluster volume start vol1
</code></pre>
</li>
</ul>
</li>
<li>
<p>Check the status on the worker VM:</p>
<ul>
<li>
<pre><code>sudo gluster volume status
</code></pre>
</li>
</ul>
</li>
<li>
<p>Mount the server with the master IP on the master VM:</p>
<ul>
<li>
<pre><code>sudo mount -t glusterfs 10.1.3.2:/vol1 /var/www
</code></pre>
</li>
</ul>
</li>
<li>
<p>See if the mount is there on the master VM:</p>
<ul>
<li>
<pre><code>df -h
</code></pre>
</li>
</ul>
</li>
<li>
<p>Mount the server with the worker IP on the worker VM:</p>
<ul>
<li>
<pre><code>sudo mount -t glusterfs 10.1.4.2:/vol1 /var/www
</code></pre>
</li>
</ul>
</li>
<li>
<p>See if the mount is there on the worker VM:</p>
<ul>
<li>
<pre><code>df -h
</code></pre>
</li>
</ul>
</li>
</ul>
<p>We now update the mount with the filse fstab on both VMs.</p>
<ul>
<li>
<p>To prevent the mount from being aborted if the server reboots, write the following on both servers:</p>
<ul>
<li>
<pre><code>sudo nano /etc/fstab
</code></pre>
</li>
</ul>
</li>
<li>
<p>Add the following line in the <code>fstab</code> file to set the master VM with the master virtual IP (here it is 10.1.3.2):</p>
<ul>
<li>
<pre><code>10.1.3.2:/vol1 /var/www glusterfs defaults,_netdev 0 0
</code></pre>
</li>
</ul>
</li>
<li>
<p>Add the following line in the <code>fstab</code> file to set the worker VM with the worker virtual IP (here it is 10.1.4.2):</p>
<ul>
<li>
<pre><code>10.1.4.2:/vol1 /var/www glusterfs defaults,_netdev 0 0
</code></pre>
</li>
</ul>
</li>
</ul>
<hr />
<h1 id="install-php-and-nextcloud"><a class="header" href="#install-php-and-nextcloud">Install PHP and Nextcloud</a></h1>
<ul>
<li>Install PHP and the PHP modules for Nextcloud on both the master and the worker:
<ul>
<li>
<pre><code>sudo apt install php -y &amp;&amp; sudo apt-get install php zip libapache2-mod-php php-gd php-json php-mysql php-curl php-mbstring php-intl php-imagick php-xml php-zip php-mysql php-bcmath php-gmp zip -y
</code></pre>
</li>
</ul>
</li>
</ul>
<p>We will now install Nextcloud. This is done only on the master VM.</p>
<ul>
<li>
<p>On both the master and worker VMs, go to the folder <code>/var/www</code>:</p>
<ul>
<li>
<pre><code>cd /var/www
</code></pre>
</li>
</ul>
</li>
<li>
<p>To install the latest Nextcloud version, go to the Nextcloud homepage:</p>
<ul>
<li>See the latest <a href="https://download.nextcloud.com/server/releases/">Nextcloud releases</a>.</li>
</ul>
</li>
<li>
<p>We now download Nextcloud on the master VM. </p>
<ul>
<li>
<pre><code>sudo wget https://download.nextcloud.com/server/releases/nextcloud-26.0.0.zip
</code></pre>
</li>
</ul>
</li>
</ul>
<p>You only need to download on the master VM, since you set a peer-to-peer connection, it will also be accessible on the worker VM.</p>
<ul>
<li>
<p>Then, extract the <code>.zip</code> file. This will take a couple of minutes. We use 7z to track progress:</p>
<ul>
<li>
<pre><code>sudo apt install p7zip-full -y
</code></pre>
</li>
<li>
<pre><code>sudo 7z x nextcloud-26.0.0.zip -o/var/www/
</code></pre>
</li>
</ul>
</li>
<li>
<p>After the download, see if the Nextcloud file is there on the worker VM:</p>
<ul>
<li>
<pre><code>ls
</code></pre>
</li>
</ul>
</li>
<li>
<p>Then, we grant permissions to the folder. Do this on both the master VM and the worker VM.</p>
<ul>
<li>
<pre><code>sudo chown www-data:www-data /var/www/nextcloud/ -R
</code></pre>
</li>
</ul>
</li>
</ul>
<hr />
<h1 id="create-a-subdomain-with-duckdns"><a class="header" href="#create-a-subdomain-with-duckdns">Create a Subdomain with DuckDNS</a></h1>
<p>We want to create a subdomain to access Nextcloud over the public internet.</p>
<p>For this guide, we use DuckDNS to create a subdomain for our Nextcloud deployment. Note that this can be done with other services. We use DuckDNS for simplicity. We invite users to explore other methods as they see fit.</p>
<p>We create a public subdomain with DuckDNS. To set DuckDNS, you simply need to follow the steps on their website. Make sure to do this for both VMs.</p>
<ul>
<li>First, sign in on the website: <a href="https://www.duckdns.org/">https://www.duckdns.org/</a>. </li>
<li>Then go to <a href="https://www.duckdns.org/install.jsp">https://www.duckdns.org/install.jsp</a> and follow the steps. For this guide, we use <code>linux cron</code> as the operating system.</li>
</ul>
<p>Hint: make sure to save the DuckDNS folder in the home menu. Write <code>cd ~</code> before creating the folder to be sure.</p>
<h2 id="worker-file-for-duckdns"><a class="header" href="#worker-file-for-duckdns">Worker File for DuckDNS</a></h2>
<p>In our current scenario, we want to make sure the master VM stays the main IP address for the DuckDNS subdomain as long as the master VM is online. To do so, we add an <code>if</code> statement in the worker VM's <code>duck.sh</code> file. The process is as follow: the worker VM will ping the master VM and if it sees that the master VM is offline, it will run the command to update DuckDNS's subdomain with the worker VM's IP address. When the master VM goes back online, it will run the <code>duck.sh</code> file within 5 minutes and the DuckDNS's subdomain will be updated with the master VM's IP address.</p>
<p>The content of the <code>duck.sh</code> file for the worker VM is the following. Make sure to replace the line <code>echo ...</code> with the line provided by DuckDNS and to replace <code>mastervm_IPv4_address</code> with the master VM's IP address.</p>
<pre><code>ping -c 2 mastervm_IPv4_address

if [ $? != 0 ] 
then 
  
  echo url=&quot;https://www.duckdns.org/update?domains=exampledomain&amp;token=a7c4d0ad-114e-40ef-ba1d-d217904a50f2&amp;ip=&quot; | curl -k -o ~/duckdns/duck.log -K -
  
fi

</code></pre>
<p>Note: When the master VM goes offline, after 5 minutes maximum DuckDNS will change the IP address from the master’s to the worker’s. Without clearing the DNS cache, your browser might have some difficulties connecting to the updated IP address when reaching the URL <code>subdomain.duckdns.org</code>. Thus you might need to <a href="https://blog.hubspot.com/website/flush-dns">clear your DNS cache</a>. You can also use the <a href="https://www.torproject.org/">Tor browser</a> to connect to Nextcloud. If the IP address changes, you can simply leave the browser and reopen another session as the browser will automatically clear the DNS cache.</p>
<hr />
<h1 id="set-apache"><a class="header" href="#set-apache">Set Apache</a></h1>
<p>We now want to tell Apache where to store the Nextcloud data. To do this, we will create a file called <code>nextcloud.conf</code>.</p>
<ul>
<li>On both the master and worker VMs, write the following:
<ul>
<li>
<pre><code>sudo nano /etc/apache2/sites-available/nextcloud.conf
</code></pre>
</li>
</ul>
</li>
</ul>
<p>The file should look like this, with your own subdomain instead of <code>subdomain</code>:</p>
<pre><code>&lt;VirtualHost *:80&gt;
        DocumentRoot &quot;/var/www/nextcloud&quot;
        ServerName subdomain.duckdns.org
        ServerAlias www.subdomain.duckdns.org

        ErrorLog ${APACHE_LOG_DIR}/nextcloud.error
        CustomLog ${APACHE_LOG_DIR}/nextcloud.access combined

        &lt;Directory /var/www/nextcloud/&gt;
            Require all granted
            Options FollowSymlinks MultiViews
            AllowOverride All

           &lt;IfModule mod_dav.c&gt;
               Dav off
           &lt;/IfModule&gt;

        SetEnv HOME /var/www/nextcloud
        SetEnv HTTP_HOME /var/www/nextcloud
        Satisfy Any

       &lt;/Directory&gt;

&lt;/VirtualHost&gt;
</code></pre>
<ul>
<li>
<p>On both the master VM and the worker VM, write the following to set the Nextcloud database with Apache and to enable the new virtual host file:</p>
<ul>
<li>
<pre><code>sudo a2ensite nextcloud.conf &amp;&amp; sudo a2enmod rewrite headers env dir mime setenvif ssl
</code></pre>
</li>
</ul>
</li>
<li>
<p>Then, reload and restart Apache:</p>
<ul>
<li>
<pre><code>sudo systemctl reload apache2 &amp;&amp; sudo systemctl restart apache2
</code></pre>
</li>
</ul>
</li>
</ul>
<hr />
<h1 id="access-nextcloud-on-a-web-browser-with-the-subdomain"><a class="header" href="#access-nextcloud-on-a-web-browser-with-the-subdomain">Access Nextcloud on a Web Browser with the Subdomain</a></h1>
<p>We now access Nextcloud over the public Internet.</p>
<ul>
<li>Go to a web browser and write the subdomain name created with DuckDNS (adjust with your own subdomain):
<ul>
<li>
<pre><code>subdomain.duckdns.org
</code></pre>
</li>
</ul>
</li>
</ul>
<p>Note: HTTPS isn't yet enabled. If you can't access the website, make sure to enable HTTP websites on your browser.</p>
<ul>
<li>
<p>Choose a name and a password. For this guide, we use the following:</p>
<ul>
<li>
<pre><code>ncadmin
password1234
</code></pre>
</li>
</ul>
</li>
<li>
<p>Enter the Nextcloud Database information created with MariaDB and click install:</p>
<ul>
<li>
<pre><code>Database user: ncuser
Database password: password1234
Database name: nextcloud
Database location: localhost
</code></pre>
</li>
</ul>
</li>
</ul>
<p>Nextcloud will then proceed to complete the installation. </p>
<p>We use <code>localhost</code> as the database location. You do not need to specifiy MariaDB's port (<code>3306</code>), as it is already configured within the database.</p>
<p>After the installation, you can now access Nextcloud. To provide further security, we want to enable HTTPS for the subdomain.</p>
<hr />
<h1 id="enable-https"><a class="header" href="#enable-https">Enable HTTPS</a></h1>
<h2 id="install-certbot"><a class="header" href="#install-certbot">Install Certbot</a></h2>
<p>We will now enable HTTPS. This needs to be done on the master VM as well as the worker VM. This section can be done simultaneously on the two VMs. But make sure to do the next section on setting the Certbot with only one VM at a time.</p>
<p>To enable HTTPS, first install <code>letsencrypt</code> with <code>certbot</code>:</p>
<p>Install certbot by following the steps here: <a href="https://certbot.eff.org/">https://certbot.eff.org/</a></p>
<ul>
<li>
<p>See if you have the latest version of snap:</p>
<ul>
<li>
<pre><code>sudo snap install core; sudo snap refresh core
</code></pre>
</li>
</ul>
</li>
<li>
<p>Remove certbot-auto:</p>
<ul>
<li>
<pre><code>sudo apt-get remove certbot
</code></pre>
</li>
</ul>
</li>
<li>
<p>Install certbot:</p>
<ul>
<li>
<pre><code>sudo snap install --classic certbot
</code></pre>
</li>
</ul>
</li>
<li>
<p>Ensure that certbot can be run:</p>
<ul>
<li>
<pre><code>sudo ln -s /snap/bin/certbot /usr/bin/certbot
</code></pre>
</li>
</ul>
</li>
<li>
<p>Then, install certbot-apache:</p>
<ul>
<li>
<pre><code>sudo apt install python3-certbot-apache -y
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="set-the-certbot-with-the-dns-domain"><a class="header" href="#set-the-certbot-with-the-dns-domain">Set the Certbot with the DNS Domain</a></h2>
<p>To avoid errors, set HTTPS with the master VM and power off the worker VM. </p>
<ul>
<li>To do so with a 3node, you can simply comment the <code>vms</code> section of the worker VM in the Terraform <code>main.tf</code> file and do <code>terraform apply</code> on the terminal.
<ul>
<li>Put <code>/*</code> one line above the section, and <code>*/</code> one line below the section <code>vms</code>:</li>
</ul>
</li>
</ul>
<pre><code>/*
  vms {
    name       = &quot;vm2&quot;
    flist      = &quot;https://hub.grid.tf/tf-official-vms/ubuntu-22.04.flist&quot;
    cpu        = var.cpu
    mounts {
        disk_name = &quot;disk2&quot;
        mount_point = &quot;/disk2&quot;
    }
    memory     = var.memory
    entrypoint = &quot;/sbin/zinit init&quot;
    env_vars = {
      SSH_KEY = var.SSH_KEY
    }
    publicip   = true
    planetary = true
  }
*/
</code></pre>
<ul>
<li>Put <code>#</code> in front of the appropriated lines, as shown below:</li>
</ul>
<pre><code>output &quot;node1_zmachine1_ip&quot; {
  value = grid_deployment.d1.vms[0].ip
}
#output &quot;node1_zmachine2_ip&quot; {
#  value = grid_deployment.d2.vms[0].ip
#}

output &quot;ygg_ip1&quot; {
  value = grid_deployment.d1.vms[0].ygg_ip
}
#output &quot;ygg_ip2&quot; {
#  value = grid_deployment.d2.vms[0].ygg_ip
#}

output &quot;ipv4_vm1&quot; {
  value = grid_deployment.d1.vms[0].computedip
}

#output &quot;ipv4_vm2&quot; {
#  value = grid_deployment.d2.vms[0].computedip
#}
</code></pre>
<ul>
<li>
<p>To add the HTTPS protection, write the following line on the master VM with your own subdomain:</p>
<ul>
<li>
<pre><code>sudo certbot --apache -d subdomain.duckdns.org -d www.subdomain.duckdns.org
</code></pre>
</li>
</ul>
</li>
<li>
<p>Once the HTTPS is set, you can reset the worker VM:</p>
<ul>
<li>To reset the worker VM, simply remove <code>/*</code>, <code>*/</code> and <code>#</code> on the main file and redo <code>terraform apply</code> on the terminal.</li>
</ul>
</li>
</ul>
<p>Note: You then need to redo the same process with the worker VM. This time, make sure to set the master VM offline to avoid errors. This means that you should comment the section <code>vms</code>of <code>vm1</code>instead of <code>vm2</code>.</p>
<h2 id="verify-https-automatic-renewal"><a class="header" href="#verify-https-automatic-renewal">Verify HTTPS Automatic Renewal</a></h2>
<ul>
<li>Make a dry run of the certbot renewal to verify that it is correctly set up.
<ul>
<li>
<pre><code>sudo certbot renew --dry-run
</code></pre>
</li>
</ul>
</li>
</ul>
<p>You now have HTTPS security on your Nextcloud instance.</p>
<h1 id="set-a-firewall"><a class="header" href="#set-a-firewall">Set a Firewall</a></h1>
<p>Finally, we want to set a firewall to monitor and control incoming and outgoing network traffic. To do so, we will define predetermined security rules. As a firewall, we will be using <a href="https://wiki.ubuntu.com/UncomplicatedFirewall">Uncomplicated Firewall</a> (ufw).</p>
<p>It should already be installed on your system. If it is not, install it with the following command:</p>
<pre><code>sudo apt install ufw
</code></pre>
<p>For our security rules, we want to allow SSH, HTTP and HTTPS.</p>
<p>We thus add the following rules:</p>
<ul>
<li>
<p>Allow SSH (port 22)</p>
<ul>
<li>
<pre><code>sudo ufw allow ssh
</code></pre>
</li>
</ul>
</li>
<li>
<p>Allow HTTP (port 80)</p>
<ul>
<li>
<pre><code>sudo ufw allow http
</code></pre>
</li>
</ul>
</li>
<li>
<p>Allow https (port 443)</p>
<ul>
<li>
<pre><code>sudo ufw allow https
</code></pre>
</li>
</ul>
</li>
<li>
<p>To enable the firewall, write the following:</p>
<ul>
<li>
<pre><code>sudo ufw enable
</code></pre>
</li>
</ul>
</li>
<li>
<p>To see the current security rules, write the following:</p>
<ul>
<li>
<pre><code>sudo ufw status verbose
</code></pre>
</li>
</ul>
</li>
</ul>
<p>You now have enabled the firwall with proper security rules for your Nextcloud deployment.</p>
<hr />
<h1 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h1>
<p>If everything went smooth, you should now be able to access Nextcloud over the Internet with HTTPS security from any computer or smart phone!</p>
<p>The Nextcloud database is synced in real-time on two different 3nodes. When one 3node goes offline, the database is still synchronized on the other 3node. Once the powered-off 3node goes back online, the database is synced automatically with the node that was powered off.</p>
<p>You can now <a href="https://nextcloud.com/install/">install Nextcloud</a> on your local computer. You will then be able to &quot;use the desktop clients to keep your files synchronized between your Nextcloud server and your desktop&quot;. You can also do regular backups with Nextcloud to ensure maximum resilience of your data. Check Nextcloud's <a href="https://docs.nextcloud.com/server/latest/admin_manual/maintenance/backup.html">documentation</a> for more information on this.</p>
<p>You should now have a basic understanding of the Threefold Grid, GraphQL, Wireguard, Terraform, MariaDB, GlusterFS, PHP and Nextcloud. Now, you know how to deploy workloads on the Threefold Grid with an efficient architecture in order to ensure redundancy. This is just the beginning. The Threefold Grid has a somewhat infinite potential when it comes to deployments, workloads, architectures and server projects. Let's see where it goes from here!</p>
<p>This Nextcloud deployment could be improved in many ways and other guides might be published in the future with enhanced functionalities. Stay tuned for more Threefold Guides. If you have ideas on how to improve this guide, please let us know. We learn best when sharing knowledge.</p>
<hr />
<h1 id="acknowledgements-and-references"><a class="header" href="#acknowledgements-and-references">Acknowledgements and References</a></h1>
<p>A big thank you to <a href="https://github.com/scottyeager">Scott Yeager</a> for his help on brainstorming, troubleshooting and creating this tutorial. This guide wouldn't have been properly done without his time and dedication. This really is a team effort!</p>
<p>The main reference for this guide is this <a href="https://youtu.be/ARsqxUw1ONc">amazing video</a> by NETVN82. Many steps were modified or added to make this suitable with Wireguard and the Threefold Grid. Other configurations are possible. We invite you to explore the possibilities offered by the Threefold Grid!</p>
<p>This guide has been inspired by Weynand Kuijpers' <a href="https://youtu.be/DIhfSRKAKHw">great tutorial</a> on how to deploy Nextcloud with Terraform.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../terraform/advanced/terraform_updates.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../javascript/grid3_javascript_readme.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../terraform/advanced/terraform_updates.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../javascript/grid3_javascript_readme.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
